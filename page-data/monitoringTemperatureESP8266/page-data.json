{"componentChunkName":"component---src-templates-blog-post-js","path":"/monitoringTemperatureESP8266/","result":{"data":{"site":{"siteMetadata":{"title":"Technical Debt"}},"markdownRemark":{"id":"51edbeec-b5d0-5e5b-9685-5b7db9dcf871","excerpt":"L’ESP8266 est un circuit intégré à microcontrôleur avec connexion Wi-Fi développé par le fabricant chinois Espressif.  Il est ici utilisé avec un capteur de…","html":"<p>L’<a href=\"https://fr.wikipedia.org/wiki/ESP8266\">ESP8266</a> est un circuit intégré à microcontrôleur avec connexion Wi-Fi développé par le fabricant chinois Espressif. </p>\n<p>Il est ici utilisé avec un capteur de température et d’humidité DHT22 (ou AM2302).</p>\n<h1>Montage</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/technical-debt/static/7d72b756525ee2be21f5c2b90bf16748/274e1/photo1.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 177.8481012658228%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAkABQDASIAAhEBAxEB/8QAGQABAAMBAQAAAAAAAAAAAAAAAAIDBAUB/8QAFgEBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAHf7ghHVByIb4mpItdRc3Ca/8QAHBAAAgIDAQEAAAAAAAAAAAAAAAIBAwQREhAi/9oACAEBAAEFAvcltLjT9GSYk6NDpDxXWtcirDDVL3yp/8QAFhEAAwAAAAAAAAAAAAAAAAAAABEg/9oACAEDAQE/AZZ//8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwFf/8QAGxAAAgIDAQAAAAAAAAAAAAAAAAEQESExQVH/2gAIAQEABj8ClV6OEOMjrsOzqNH/xAAbEAEAAwADAQAAAAAAAAAAAAABABEhEDFRQf/aAAgBAQABPyGHCkSX8RDdTOOtvYStl4QztyvnqMSuCAKzTVRD6PBh5Z//2gAMAwEAAgADAAAAEEwTwIwP/8QAGBEAAgMAAAAAAAAAAAAAAAAAABEQQVH/2gAIAQMBAT8Qlljaf//EABgRAAIDAAAAAAAAAAAAAAAAAAARARBB/9oACAECAQE/ELRgoP/EAB4QAQACAgEFAAAAAAAAAAAAAAEAESExUUFhcYGh/9oACAEBAAE/EFa9xQWpgooqp5hrblrbpduYajDp1nxg3kYW7agNsnF6h69sRgapd9pkTmLAole5BpDi4gyvkn//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Esp8266\"\n        title=\"Esp8266\"\n        src=\"/technical-debt/static/7d72b756525ee2be21f5c2b90bf16748/828fb/photo1.jpg\"\n        srcset=\"/technical-debt/static/7d72b756525ee2be21f5c2b90bf16748/ff44c/photo1.jpg 158w,\n/technical-debt/static/7d72b756525ee2be21f5c2b90bf16748/a6688/photo1.jpg 315w,\n/technical-debt/static/7d72b756525ee2be21f5c2b90bf16748/828fb/photo1.jpg 630w,\n/technical-debt/static/7d72b756525ee2be21f5c2b90bf16748/0ede0/photo1.jpg 945w,\n/technical-debt/static/7d72b756525ee2be21f5c2b90bf16748/3ac88/photo1.jpg 1260w,\n/technical-debt/static/7d72b756525ee2be21f5c2b90bf16748/274e1/photo1.jpg 2160w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/technical-debt/static/a3a2c89e45ed3ffa76cc437e9d369eef/e6b01/photo2.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAEDBP/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHVCyhiF//EABgQAQADAQAAAAAAAAAAAAAAAAEAAhAR/9oACAEBAAEFAo3S/cM//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGRAAAQUAAAAAAAAAAAAAAAAAEQABAiBh/9oACAEBAAY/AkGidr//xAAZEAEBAAMBAAAAAAAAAAAAAAABABExUSH/2gAIAQEAAT8hAX1xZljxZ8m2nd//2gAMAwEAAgADAAAAEPwP/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQMBAT8Qiv/EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAECAQE/EKf/xAAbEAEAAgIDAAAAAAAAAAAAAAABABEhMUFxgf/aAAgBAQABPxBECa2zWBaSjMoOHsyYC3U3T//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"DHT22\"\n        title=\"DHT22\"\n        src=\"/technical-debt/static/a3a2c89e45ed3ffa76cc437e9d369eef/828fb/photo2.jpg\"\n        srcset=\"/technical-debt/static/a3a2c89e45ed3ffa76cc437e9d369eef/ff44c/photo2.jpg 158w,\n/technical-debt/static/a3a2c89e45ed3ffa76cc437e9d369eef/a6688/photo2.jpg 315w,\n/technical-debt/static/a3a2c89e45ed3ffa76cc437e9d369eef/828fb/photo2.jpg 630w,\n/technical-debt/static/a3a2c89e45ed3ffa76cc437e9d369eef/0ede0/photo2.jpg 945w,\n/technical-debt/static/a3a2c89e45ed3ffa76cc437e9d369eef/3ac88/photo2.jpg 1260w,\n/technical-debt/static/a3a2c89e45ed3ffa76cc437e9d369eef/e6b01/photo2.jpg 3840w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>La pin - de la sonde sur une pin Ground de l’esp.  </li>\n<li>La pin + de la sonde sur une pin 3V de l’esp.  </li>\n<li>La pin du milieu sur l’une des pin d1 de l’esp. Il faudra réutiliser le même numéro de pin dans le code ci-dessous. </li>\n</ul>\n<h1>Code</h1>\n<p>Dans ArduinoIDE, utiliser le type de carte esp8266 >NodeMCU 0.9.</p>\n<blockquote>\n<p>Penser aussi à charger les cartes et librairies esp8266: <a href=\"https://arduino.esp8266.com/stable/package_esp8266com_index.json\">https://arduino.esp8266.com/stable/package_esp8266com_index.json</a></p>\n</blockquote>\n<p>Plus d’info <a href=\"https://projetsdiy.fr/programmer-esp8266-ide-arduino-librairies-gpio-web-serveur-client/\">ici</a> </p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">    <span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;Arduino.h></span></span>\n    <span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;ESP8266WiFi.h></span></span>\n    <span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;ESP8266WiFiMulti.h></span></span>\n    <span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;ESP8266HTTPClient.h></span></span>\n    <span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;WiFiClient.h></span></span>\n    <span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"DHT.h\"</span></span>\n    <span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token expression\">DHTTYPE DHT22</span></span>\n\n    ESP8266WiFiMulti WiFiMulti<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// DHT Sensor</span>\n    uint8_t DHTPin <span class=\"token operator\">=</span> D1<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Initialize DHT sensor.</span>\n    DHT <span class=\"token function\">dht</span><span class=\"token punctuation\">(</span>DHTPin<span class=\"token punctuation\">,</span> DHTTYPE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">float</span> temperature<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">float</span> humidity<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> String location <span class=\"token operator\">=</span> <span class=\"token string\">\"bureau_rdc\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> ssid <span class=\"token operator\">=</span> <span class=\"token string\">\"Livebox-*****\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> password <span class=\"token operator\">=</span> <span class=\"token string\">\"crAzYpssWD\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> <span class=\"token keyword\">int</span> delayInMin <span class=\"token operator\">=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">void</span> <span class=\"token function\">setup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n      Serial<span class=\"token punctuation\">.</span><span class=\"token function\">begin</span><span class=\"token punctuation\">(</span><span class=\"token number\">9600</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// Serial.setDebugOutput(true);</span>\n\n      Serial<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>uint8_t t <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span> t <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> t<span class=\"token operator\">--</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        Serial<span class=\"token punctuation\">.</span><span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[SETUP] WAIT %d...\\n\"</span><span class=\"token punctuation\">,</span> t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        Serial<span class=\"token punctuation\">.</span><span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      WiFi<span class=\"token punctuation\">.</span><span class=\"token function\">mode</span><span class=\"token punctuation\">(</span>WIFI_STA<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      WiFiMulti<span class=\"token punctuation\">.</span><span class=\"token function\">addAP</span><span class=\"token punctuation\">(</span>ssid<span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token function\">pinMode</span><span class=\"token punctuation\">(</span>DHTPin<span class=\"token punctuation\">,</span> INPUT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      dht<span class=\"token punctuation\">.</span><span class=\"token function\">begin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">void</span> <span class=\"token function\">loop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// wait for WiFi connection</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>WiFiMulti<span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> WL_CONNECTED<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n        temperature <span class=\"token operator\">=</span> dht<span class=\"token punctuation\">.</span><span class=\"token function\">readTemperature</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Gets the values of the temperature</span>\n        humidity <span class=\"token operator\">=</span> dht<span class=\"token punctuation\">.</span><span class=\"token function\">readHumidity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Gets the values of the humidity</span>\n\n        HTTPClient http<span class=\"token punctuation\">;</span>\n        Serial<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[HTTP] begin...\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        String url <span class=\"token operator\">=</span> <span class=\"token string\">\"http://192.168.1.21:5000/\"</span><span class=\"token punctuation\">;</span>\n        String postData <span class=\"token operator\">=</span> <span class=\"token string\">\"{\\\"temperature\\\": \\\"\"</span> <span class=\"token operator\">+</span> <span class=\"token function\">String</span><span class=\"token punctuation\">(</span>temperature<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"\\\" , \\\"humidity\\\": \\\"\"</span> <span class=\"token operator\">+</span> <span class=\"token function\">String</span><span class=\"token punctuation\">(</span>humidity<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"\\\", \\\"location\\\": \\\"\"</span> <span class=\"token operator\">+</span> location <span class=\"token operator\">+</span> <span class=\"token string\">\"\\\"}\"</span><span class=\"token punctuation\">;</span>\n\n        Serial<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Requesting url: \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        Serial<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        Serial<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>postData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        \n        http<span class=\"token punctuation\">.</span><span class=\"token function\">begin</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        http<span class=\"token punctuation\">.</span><span class=\"token function\">addHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Content-Type\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"application/json\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">auto</span> httpCode <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">POST</span><span class=\"token punctuation\">(</span>postData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        Serial<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>httpCode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>httpCode <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          Serial<span class=\"token punctuation\">.</span><span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[HTTP] POST... failed, error: %s\\n\"</span><span class=\"token punctuation\">,</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">errorToString</span><span class=\"token punctuation\">(</span>httpCode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">c_str</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        http<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//Close connection Serial.println();</span>\n        Serial<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"closing connection\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        Serial<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error in WiFi connection\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span>delayInMin <span class=\"token operator\">*</span> <span class=\"token number\">1000</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>Ce code permet de récupérer les données de température et d’humidité puis de les envoyer via HTTP sur un serveur distant. </p>","frontmatter":{"title":"Monitoring de température","date":"November 28, 2020","description":null}}},"pageContext":{"slug":"/monitoringTemperatureESP8266/","previous":{"fields":{"slug":"/diskusage/"},"frontmatter":{"title":"Disk Usage"}},"next":null}},"staticQueryHashes":["2841359383","916993862"]}