{"componentChunkName":"component---src-templates-blog-post-js","path":"/construire_son_rpm_avec_maven/","result":{"data":{"site":{"siteMetadata":{"title":"Technical Debt"}},"markdownRemark":{"id":"ffcbc572-b146-584b-b506-5f4d8b8d82ad","excerpt":"Comment builder son RPM ? L’outil ‘rpmbuild’ semble bien nommé pour faire le job. Mais le build du projet étant fait avec Maven, il semble naturel d’intégrer…","html":"<p>Comment builder son RPM ? L’outil ‘rpmbuild’ semble bien nommé pour faire le job. Mais le build du projet étant fait avec Maven, il semble naturel d’intégrer cette construction avec un plugin Maven.</p>\n<p>Plusieurs plugins Maven sont  disponibles mais je choisis rpm-maven-plugin de chez codehaus pour la quantité d’articles dédiés trouvés sur google.</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>plugin</span><span class=\"token punctuation\">></span></span>\n     <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.codehaus.mojo<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>\n     <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>rpm-maven-plugin<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span>\n     <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.0.1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>plugin</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Il suffit donc d’insérer dans sa séquence de build l’appel au plugin. Beaucoup d’options et de configuration s’offrent à nous.  </p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>!–</span> <span class=\"token attr-name\">RPM</span> <span class=\"token attr-name\">generator</span> <span class=\"token attr-name\">–</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>plugin</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.codehaus.mojo<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>rpm-maven-plugin<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>executions</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>execution</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>id</span><span class=\"token punctuation\">></span></span>rpm<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>id</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>phase</span><span class=\"token punctuation\">></span></span>package<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>phase</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>goals</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>goal</span><span class=\"token punctuation\">></span></span>attached-rpm<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>goal</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>goals</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>execution</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>executions</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>copyright</span><span class=\"token punctuation\">></span></span>2000-2014 Technical Debt.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>copyright</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>distribution</span><span class=\"token punctuation\">></span></span>RH6.2 64<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>distribution</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>group</span><span class=\"token punctuation\">></span></span>Application/Collectors<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>group</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>packager</span><span class=\"token punctuation\">></span></span>Technical Debt<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>packager</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>changelogFile</span><span class=\"token punctuation\">></span></span>PathVersLeChangeLog/changelog.txt<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>changelogFile</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>test-rpm<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>${project.version}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mappings</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>!–</span> <span class=\"token attr-name\">RPM</span> <span class=\"token attr-name\">content</span> <span class=\"token attr-name\">–</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapping</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>directory</span><span class=\"token punctuation\">></span></span>PathOuVousVoudrezInstallerVotreApp<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>directory</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>filemode</span><span class=\"token punctuation\">></span></span>640<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>filemode</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>username</span><span class=\"token punctuation\">></span></span>user-name<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>username</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupname</span><span class=\"token punctuation\">></span></span>user-group<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupname</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>sources</span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>source</span><span class=\"token punctuation\">></span></span>\n                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>location</span><span class=\"token punctuation\">></span></span>PathDeCeQuiDoitEtreInclusDsLeRPM<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>location</span><span class=\"token punctuation\">></span></span>\n                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>includes</span><span class=\"token punctuation\">></span></span>\n                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>include</span><span class=\"token punctuation\">></span></span>**<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>include</span><span class=\"token punctuation\">></span></span>\n                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>includes</span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>source</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>sources</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mapping</span><span class=\"token punctuation\">></span></span>\n         <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mappings</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pretransScriptlet</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scriptFile</span><span class=\"token punctuation\">></span></span>PathVersLesScripts/pretrans.sh<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scriptFile</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>fileEncoding</span><span class=\"token punctuation\">></span></span>UTF-8<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>fileEncoding</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>pretransScriptlet</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>preinstallScriptlet</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scriptFile</span><span class=\"token punctuation\">></span></span>PathVersLesScripts/preinstall.sh<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scriptFile</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>fileEncoding</span><span class=\"token punctuation\">></span></span>UTF-8<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>fileEncoding</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>preinstallScriptlet</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>postinstallScriptlet</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scriptFile</span><span class=\"token punctuation\">></span></span>PathVersLesScripts/postinstall.sh<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scriptFile</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>fileEncoding</span><span class=\"token punctuation\">></span></span>UTF-8<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>fileEncoding</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>postinstallScriptlet</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>posttransScriptlet</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scriptFile</span><span class=\"token punctuation\">></span></span>PathVersLesScripts/posttrans.sh<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scriptFile</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>fileEncoding</span><span class=\"token punctuation\">></span></span>UTF-8<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>fileEncoding</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>posttransScriptlet</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>preremoveScriptlet</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scriptFile</span><span class=\"token punctuation\">></span></span>PathVersLesScripts/preremove.sh<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scriptFile</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>fileEncoding</span><span class=\"token punctuation\">></span></span>UTF-8<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>fileEncoding</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>preremoveScriptlet</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>postremoveScriptlet</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scriptFile</span><span class=\"token punctuation\">></span></span>PathVersLesScripts/postremove.sh<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scriptFile</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>fileEncoding</span><span class=\"token punctuation\">></span></span>UTF-8<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>fileEncoding</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>postremoveScriptlet</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>plugin</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Le tag ‘configuration’ est donc assez complet, je n’y ai mis que les choses qui me semblaient importantes mais cet exemple n’est pas exhaustif.\nLa liste exhaustive sur <a href=\"http://mojo.codehaus.org/rpm-maven-plugin/ident-params.html\">le site officiel du plugin</a>.\nOn y retrouve d’abord tout ce qui concerne les droits et propriétaires de l’application. (copyright, distribution, group, packager).\nOn enchaine sur le changelog pour suivre l’historique et sur le nom et version du RPM. Pour la version, mettre la version du pom ( ${project.version} ) pour avoir une version dynamique sans effort.</p>\n<p>Vient ensuite la balise Mappings. Ici, on va lister les éléments qui seront installés avec le RPM.\nOn peut en lister plusieurs. Un tab Mapping contient les éléments suivants:</p>\n<ul>\n<li>directory : le path où sera installer le composant sur la machine cible.</li>\n<li>filemode le chmod à utiliser sur le répertoire (ex: chmod 640)</li>\n<li>username: le user linux qui sera owner du répertoire</li>\n<li>groupname: le group name associé au répertoire. (la commande chown username:groupname sera exécutée sur le répertoire.)</li>\n<li>sources: la liste des sources à installer</li>\n<li>source: une source à installer. En attribut de la source, on retrouve le chemin de la source à installer.</li>\n</ul>\n<p>A la fin de la configuration, il y a les path vers toutes les scriptlets.\nLes scriptlets sont des scripts shell qui seront exécutés à différentes phases de l’installations. Pour plus d’infos sur l’ordre et les conditions d’exécution des scripts se référer à <a href=\"http://fedoraproject.org/wiki/Packaging:ScriptletSnippets#Scriptlet_Ordering\">ce lien</a>.\nTous les scripts sont optionnels.</p>\n<p>Afin d’avoir quelque chose d’un minimum industrialisé, il est bon de définir un profil maven pour exécuter ce plugin. (Le plugin nécessite l’application rpmbuild qui ne tourne que sous linux et ne tournera donc pas sur les machines de dev Windows.)\nEnfin mettre le tout dans un job jenkins !</p>","frontmatter":{"title":"Construire son RPM avec Maven","date":"August 19, 2014","description":null}}},"pageContext":{"slug":"/construire_son_rpm_avec_maven/","previous":null,"next":{"fields":{"slug":"/fluent_builder/"},"frontmatter":{"title":"Fluent Builder"}}}},"staticQueryHashes":["2841359383","916993862"]}